/*! For license information please see sdk.webp.js.LICENSE.txt */
(()=>{var e={483:(e,t,n)=>{e.exports=function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}c=n[a]={exports:{}},t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var o=void 0,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i,o,a=e.MutationObserver||e.WebKitMutationObserver,s=a?(n=0,a=new a(l),r=e.document.createTextNode(""),a.observe(r,{characterData:!0}),function(){r.data=n=++n%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((i=new e.MessageChannel).port1.onmessage=l,function(){i.port2.postMessage(0)}),c=[];function l(){var e,t;o=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}o=!1}t.exports=function(e){1!==c.push(e)||o||s()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(r){return o.reject(e,r)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var a=p((function(){t(i,r)}));"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(i);return this.state!==c?d(n,this.state===s?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return o.reject(e,n.value);if(n=n.value)f(e,n);else{e.state=s,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,c=-1,l=new this(i);++c<n;)!function(e,i){t.resolve(e).then((function(e){a[i]=e,++s!==n||r||(r=!0,o.resolve(l,a))}),(function(e){r||(r=!0,o.reject(l,e))}))}(e[c],c);return l},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=-1,s=new this(i);++a<n;)!function(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(s,e))}),(function(e){r||(r=!0,o.reject(s,e))}))}(e[a]);return s}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d="local-forage-detect-blob-support",h=void 0,f={},p=Object.prototype.toString,v="readonly",g="readwrite";function E(e){return"boolean"==typeof h?a.resolve(h):(t=e,new a((function(e){var n=t.transaction(d,g),r=o([""]);n.objectStore(d).put(r,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||43<=parseInt(t[1],10))}})).catch((function(){return!1})).then((function(e){return h=e})));var t}function m(e){e=f[e.name];var t={};t.promise=new a((function(e,n){t.resolve=e,t.reject=n})),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then((function(){return t.promise})):e.dbReady=t.promise}function b(e){return(e=f[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function _(e,t){if(e=f[e.name].deferredOperations.pop())return e.reject(t),e.promise}function T(e,t){return new a((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);m(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var a=i.open.apply(i,o);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(d)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){n(a.result),b(e)}}))}function S(e){return T(e,!1)}function y(e){return T(e,!0)}function I(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;return r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(i||n)&&(!n||(n=e.db.version+1)>e.version&&(e.version=n),1)}function A(e){return o([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function w(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function D(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(0<r&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){m(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,S(e).then((function(t){return e.db=t,I(e)?y(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw _(e,t),t}))}(e).then((function(){D(e,t,n,r-1)}))})).catch(n);n(i)}}var L={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=f[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=w);var o=[];function s(){return a.resolve()}for(var c=0;c<i.forages.length;c++){var l=i.forages[c];l!==t&&o.push(l._initReady().catch(s))}var u=i.forages.slice(0);return a.all(o).then((function(){return n.db=i.db,S(n)})).then((function(e){return n.db=e,I(n,t._defaultConfig.version)?y(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!i)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){D(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var n,r=a.result;r?(O(n=r.value)&&(n=A(n)),void 0!==(n=e(n,r.key,s++))?t(n):r.continue()):t()},a.onerror=function(){r(a.error)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new a((function(t,r){n.ready().then((function(){D(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;O(e=void 0===e?null:e)&&(e=A(e)),t(e)},a.onerror=function(){r(a.error)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var i=new a((function(n,i){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===p.call(t)?E(o.db).then((function(e){return e?t:(n=t,new a((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){D(r._dbInfo,g,(function(o,a){if(o)return i(o);try{var s=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){n(t=void 0===t?null:t)},a.onabort=a.onerror=function(){var e=c.error||c.transaction.error;i(e)}}catch(o){i(o)}}))})).catch(i)}));return s(i,n),i},removeItem:function(e,t){var n=this;e=l(e);var r=new a((function(t,r){n.ready().then((function(){D(n._dbInfo,g,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(a.error)},o.onabort=function(){var e=a.error||a.transaction.error;r(e)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){D(t._dbInfo,g,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error||o.transaction.error;n(e)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){D(t._dbInfo,v,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){e<0?t(null):n.ready().then((function(){D(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName),s=!1,c=a.openCursor();c.onsuccess=function(){var n=c.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){D(t._dbInfo,v,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var t=o.result;t?(a.push(t.key),t.continue()):e(a)},o.onerror=function(){n(o.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n,r=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),s(n=e.name?(n=e.name===r.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):S(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t})),e.storeName?n.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;m(e);var r=f[e.name],o=r.forages;t.close();for(var s=0;s<o.length;s++){var c=o[s];c._dbInfo.db=null,c._dbInfo.version=n}return new a((function(t,r){var o=i.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,b(n._dbInfo)}})).catch((function(t){throw(_(e,t)||a.resolve()).catch((function(){})),t}))}})):n.then((function(t){m(e);var n=f[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new a((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)b(r[t]._dbInfo)})).catch((function(t){throw(_(e,t)||a.resolve()).catch((function(){})),t}))}))):a.reject("Invalid arguments"),t),n}},N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=/^~~local_forage_type~([^~]+)~/,x="__lfsc__:",C=x.length,k="arbf",P="blob",M=C+k.length,B=Object.prototype.toString;function U(e){var t,n,r,i,o=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--),o=new ArrayBuffer(o);for(var c=new Uint8Array(o),l=0;l<a;l+=4)t=N.indexOf(e[l]),n=N.indexOf(e[l+1]),r=N.indexOf(e[l+2]),i=N.indexOf(e[l+3]),c[s++]=t<<2|n>>4,c[s++]=(15&n)<<4|r>>2,c[s++]=(3&r)<<6|63&i;return o}function F(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+=N[t[r]>>2],n+=N[(3&t[r])<<4|t[r+1]>>4],n+=N[(15&t[r+1])<<2|t[r+2]>>6],n+=N[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var W={serialize:function(e,t){var n="";if(e&&(n=B.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===B.call(e.buffer))){var r,i=x;e instanceof ArrayBuffer?(r=e,i+=k):(r=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+F(r))}else if("[object Blob]"===n)(n=new FileReader).onload=function(){var n="~~local_forage_type~"+e.type+"~"+F(this.result);t(x+P+n)},n.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,C)!==x)return JSON.parse(e);var t,n=e.substring(M),r=e.substring(C,M);r===P&&R.test(n)&&(t=(e=n.match(R))[1],n=n.substring(e[0].length));var i=U(n);switch(r){case k:return i;case P:return o([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:U,bufferToString:F};function j(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function H(e,t,n,r,i,o){e.executeSql(n,r,i,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,a):j(e,t,(function(){e.executeSql(n,r,i,o)}),o)}),o):o(e,a)}),o)}function G(e,t,n,r){var i=this;e=l(e);var o=new a((function(o,a){i.ready().then((function(){var s=t=void 0===t?null:t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?a(l):c.db.transaction((function(n){H(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){a(t)}))}),(function(t){t.code===t.QUOTA_ERR&&(0<r?o(G.apply(i,[e,s,n,r-1])):a(t))}))}))})).catch(a)}));return s(o,n),o}var z={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new a((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){j(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=W,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){H(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var o=r.rows,a=o.length,s=0;s<a;s++){var c=o.item(s),l=(l=c.value)&&i.serializer.deserialize(l);if(void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){H(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){n=(n=n.rows.length?n.rows.item(0).value:null)&&i.serializer.deserialize(n),t(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return G.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){H(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){H(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){H(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){n=n.rows.item(0).c,e(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){H(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){n=n.rows.length?n.rows.item(0).key:null,t(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){H(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,i=e.name?new a((function(t){var i,o=e.name===n.name?r._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:o,storeNames:[e.storeName]}):t((i=o,new a((function(e,t){i.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).name);e({db:i,storeNames:r})}),(function(e,n){t(n)}))}),(function(e){t(e)}))}))))})).then((function(e){return new a((function(t,n){e.db.transaction((function(r){for(var i=[],o=0,s=e.storeNames.length;o<s;o++)i.push(function(e){return new a((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}(e.storeNames[o]));a.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):a.reject("Invalid arguments");return s(i,t),i}};function V(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function q(e,t){for(var n,r,i=e.length,o=0;o<i;){if((n=e[o])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return 1;o++}}e={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=V(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=W,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,o=localStorage.length,a=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var l=(l=localStorage.getItem(c))&&t.serializer.deserialize(l);if(void 0!==(l=e(l,c.substring(i),a++)))return l}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&t.serializer.deserialize(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var i=r.ready().then((function(){var n=t=void 0===t?null:t;return new a((function(i,o){var a=r._dbInfo;a.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(a.keyPrefix+e,t),i(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}}))}))}));return s(i,n),i},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(r){t=null}return t&&t.substring(r.keyPrefix.length)}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(r=this.config(),e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n=this,r=e.name?new a((function(t){e.storeName?t(V(e,n._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):a.reject("Invalid arguments");return s(r,t),r}};var K=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Y={},X={},Q={INDEXEDDB:L,WEBSQL:z,LOCALSTORAGE:e},J=(e=[Q.INDEXEDDB._driver,Q.WEBSQL._driver,Q.LOCALSTORAGE._driver],["dropInstance"]),$=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(J),Z={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ee(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var r in n)n.hasOwnProperty(r)&&(K(n[r])?e[r]=n[r].slice():e[r]=n[r])}return e}function te(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,te),Q){var n,r;Q.hasOwnProperty(t)&&(r=(n=Q[t])._driver,this[t]=r,Y[r]||this.defineDriver(n))}this._defaultConfig=ee({},Z),this._config=ee({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}e=new(te.prototype.config=function(e){if("object"!==(void 0===e?"undefined":r(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},te.prototype.defineDriver=function(e,t,n){var r=new a((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var o=$.concat("_initStorage"),c=0,l=o.length;c<l;c++){var u=o[c];if((!q(J,u)||e[u])&&"function"!=typeof e[u])return void n(i)}!function(){for(var t=0,n=J.length;t<n;t++){var r=J[t];e[r]||(e[r]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=a.reject(t),arguments[arguments.length-1]),t}}(r))}}();var d=function(n){Y[r]&&console.info("Redefining LocalForage driver: "+r),Y[r]=e,X[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(i){n(i)}}));return c(r,t,n),r},te.prototype.driver=function(){return this._driver||null},te.prototype.getDriver=function(e,t,n){return c(e=Y[e]?a.resolve(Y[e]):a.reject(new Error("Driver not found.")),t,n),e},te.prototype.getSerializer=function(e){var t=a.resolve(W);return c(t,e),t},te.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},te.prototype.setDriver=function(e,t,n){var r=this;K(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function s(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}return e=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve(),this._driverSet=e.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}o();var c=new Error("No available storage method found.");return r._driverSet=a.reject(c),r._driverSet}()}}(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=a.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},te.prototype.supports=function(e){return!!X[e]},te.prototype._extend=function(e){ee(this,e)},te.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},te.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=$.length;e<t;e++)!function(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}(this,$[e])},te.prototype.createInstance=function(e){return new te(e)},te),t.exports=e},{3:3}]},{},[4])(4)},877:(e,t,n)=>{var r=n(570),i=n(171);(n=i).v1=r,n.v4=i,e.exports=n},327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0;return[(n=t)[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[+r]]].join("")}},217:e=>{var t,n,r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);r?(t=new Uint8Array(16),e.exports=function(){return r(t),t}):(n=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n})},570:(e,t,n)=>{var r,i,o=n(217),a=n(327),s=0,c=0;e.exports=function(e,t,n){var l=t&&n||0,u=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;null!=d&&null!=h||(p=o(),null==d&&(d=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=i=16383&(p[6]<<8|p[7])));var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=(n=void 0!==e.nsecs?e.nsecs:c+1,f-s+(n-c)/1e4);if(p<0&&void 0===e.clockseq&&(h=h+1&16383),1e4<=(n=(p<0||s<f)&&void 0===e.nsecs?0:n))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=f,i=h,n=(1e4*(268435455&(f+=122192928e5))+(c=n))%4294967296,u[l++]=n>>>24&255,u[l++]=n>>>16&255,u[l++]=n>>>8&255,u[l++]=255&n,f=f/4294967296*1e4&268435455,u[l++]=f>>>8&255,u[l++]=255&f,u[l++]=f>>>24&15|16,u[l++]=f>>>16&255,u[l++]=h>>>8|128,u[l++]=255&h;for(var v=0;v<6;++v)u[l+v]=d[v];return t||a(u)}},171:(e,t,n)=>{var r=n(217),i=n(327);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}}},t={};function n(r){var i=t[r];return void 0!==i||(i=t[r]={exports:{}},e[r](i,i.exports,n)),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{default:()=>st});const e="number",t="USER_LIFECYCLE",i={USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"},o={SCRIPT_URL:"http://localhost:3001/sample.js",EDITOR_QUERY_PARAM:"moeWpE",NO_LIVE_CAMPAIGN:"MoeWpLive",NUMBER_OF_SESSIONS:"numberOfSessions",CHECK_TEST_WEBP:"moeWpT",VERSION_FILE:"https://app-cdn.moengage.com/personalization-ui/editor/version.json",STAGING_EDITOR_FILE:"https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.staging.js",STAGING_ERROR:"Version not found in staging",EDITOR_FILE:e=>`https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.${e}.js`,CLUSTER_ENVIRONMENT_MAP:{DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com"},CLUSTERS:{dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3",dc_4:"DC_4",dc_5:"DC_5",dc_6:"DC_6",dc_100:"DC_100"},API:{LIVE:"v1/experiences/web/live",TEST:"v1/experiences/web/test",STATS:"v1/experiences/web/stats",WEB_ACTION:"v1/experiences/web/actions",LIVE_RECOMMENDATIONS:"v1/experiences/web/live_recom",SPLIT_URL:"v1/experiences/web/split",TAB_DATA:"v1/experiences/web/recommendations"},STORES:{DATABASE_NAME:"moe_webp",EXPERIENCES:{STORE_NAME:"experiences"},AI_EXPERIENCES:{STORE_NAME:"ai_experiences",AI_EXPERIENCE_IDS:"ai_experience_ids",WEB_ACTION_EVENTS:"web_action_events",WEB_ACTIONS_LAST_FETCHED_TIME:"web_actions_last_fetched_time"},META:{STORE_NAME:"meta",LAST_FETCHED_TIME:"last_fetched_time",USER_IN_GCG:"user_in_gcg"},IN_SESSION:{STORE_NAME:"inSession",IN_SESSION_EVENTS:"in_session_events",IN_SESSION_EVENTS_HISTORY:"in_session_events_history"},SPLIT_EXPERIENCES:{STORE_NAME:"split_experiences"},TABBED_EXPERIENCES:{STORE_NAME:"tabbed_experiences"}},EVENTS:{IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",CLICK:"MOE_WEBP_MESSAGE_CLICKED"},USER_DATA:"USER_DATA",DEVICE_DATA:"DEVICE_DATA",IDENTITY_MAP:"IDENTITY_MAP",MOE_UUID:"moe_uuid",RETRY_INTERVAL:3e3,RETRY_MAX_TIME:30,SESSION:"SESSION",PRE_PROD:"PRE_PROD",MAX_EVENTS_FOR_IN_SESSION:10,MAX_RETRY_OPERATION_ATTEMPTES:20,FUNCTION_DEBOUNCE_TIME:500,ANTI_FLICKER_STYLESHEET:"moe-flicker-style",ANTI_FLICKER_HIDE:"moe-anti-flicker-hide",ANTI_FLICKER_SHOW:"moe-anti-flicker-show",ANTI_FLICKER_CLASSNAME:"moe-anti-flicker-style",SYNC_TIME_FOR_WEB_ACTION_EVENTS:1440,DATA_MOE_SELECTOR_ID:"data-moe-id"},a="MoengagePageEventHistoryManager",s={ELEMENT_BORDER_CLASS:"moe-show-personalized-experience",DATA_ATTRIBUTE:{LABEL_NAME:"data-moe-personalized-label",BACKUP_TITLE:"data-moe-backup-title"},STYLE:{STYLE_ID:"moe-personalized-experience-css",STYLE_DATA:"\n    .moe-show-personalized-experience {\n      outline-offset: -3px;\n      outline: 3px dashed #06A6B7;\n      border: 3px dashed #06A6B7;\n    }\n    .tooltip {\n      visibility: hidden;\n      opacity: 0;\n      transition: opacity 0.2s, visibility 0.2s;\n      color: #fff;\n      border: 1px solid #06A6B7;\n      border-radius: 3px;\n      background-color: #06A6B7;\n      padding: 4px;\n      font-size: 12px;\n      white-space: nowrap;\n      position: fixed;\n      z-index: 1000;\n      pointer-events: none; /* Ensures the tooltip doesn't interfere with mouse events */\n    }\n    .tooltip.visible {\n      visibility: visible;\n      opacity: 1;\n    }\n    "},LABELS:{update:"Text edited",attribute:"Attributes updated",tracking:"Tracking enabled",insert:"Custom HTML added",insert_js:"",update_outerhtml:"HTML edited",rearrange:"Element rearranged",insert_image:"Image added",replace:"Element replaced"}};function c(e,t,n){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?c(e,t.slice(1),n):void 0===e?n||null:e:null}class l{static set(e,t){l.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return c(window,"moeInternals.ephemeral."+e,null)}}l.baseLogTag="EphemeralStorage";const u="initData",d="unifiedLogs",h={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",OPTED_STATUS_TRACK_TIME:"OPTED_STATUS_TRACK_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION",DEVICE_DATA:"DEVICE_DATA",IDENTITY_MAP:"IDENTITY_MAP",SDK_VERSION:"SDK_VERSION"},f=2,p=["USER_ATTRIBUTE_UNIQUE_ID","USER_ID_MODIFIED_FROM","USER_ATTRIBUTE_USER_EMAIL","USER_ATTRIBUTE_USER_MOBILE"],v={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com",EU:"sdk-02.moengage.com",IN:"sdk-03.moengage.com"};var g;class E{constructor(){this.items=[]}static enqueue(e,t){e=E.getLocalStorageQName(e);let n=new E;x.get(e)&&(n=x.get(e)),n.items.push(t),n.items=n.items.slice(Math.max(n.items.length-50,0)),x.set(e,n)}static dequeue(e){e=E.getLocalStorageQName(e);const t=x.get(e);let n=null;return t&&0<t.items.length&&(n=t.items[0],t.items.splice(0,1),x.set(e,t)),n}static isEmpty(e){return e=E.getLocalStorageQName(e),!(x.get(e)&&0<x.get(e).items.length)}static purge(e){var t=E.getLocalStorageQName(e);E.isEmpty(e)||x.remove(t)}static getLocalStorageQName(e){return h.Q.PREFIX+"_"+e}}class m{constructor(e){m.baseLogTag,this.placeholder=c(e,"placeholder",""),this.enable=c(e,"enable",!1),this.overLayColor=c(e,"overLayColor","rgba(0, 0, 0, 0.8)"),this.backgroundColor=c(e,"backgroundColor","#F6FBFC"),this.navigationBar=new b(c(e,"navigationBar",{})),this.closeButton=new S(c(e,"closeButton",{})),this.tab=new y(c(e,"tab",{})),this.cardDismiss=new I(c(e,"cardDismiss",{})),this.optionButtonColor=c(e,"optionButtonColor","#C4C4C4"),this.dateTimeColor=c(e,"dateTimeColor","#8E8E8E"),this.unclickedCardIndicatorColor=c(e,"unclickedIndicatorColor","blue"),this.pinIcon=c(e,"pinIcon","https://app-cdn.moengage.com/sdk/pin-icon.svg"),this.refreshIcon=c(e,"refreshIcon","https://app-cdn.moengage.com/sdk/refresh-icon.svg"),this.webFloating=new w(c(e,"webFloating",{})),this.mWebFloating=new w(c(e,"mWebFloating",{countBackgroundColor:"#FF5A5F",enable:!1,icon:"https://app-cdn.moengage.com/sdk/bell-icon.svg",countColor:"#fff",postion:"0px 10px 40px 0",iconBackgroundColor:"#D9DFED"})),this.card=new T(c(e,"card",{})),this.errorContent=new _(c(e,"errorContent",{})),this.noDataContent=new D(c(e,"noDataContent",{})),this.openInbox=c(e,"openInbox",(()=>{})),this.zIndex=c(e,"zIndex","999999"),this.fontFaces=(null===(e=e.fontFaces)||void 0===e?void 0:e.map((e=>new A(e))))||[]}}m.baseLogTag="CardsConfigModel";class b{constructor(e){this.backgroundColor=c(e,"backgroundColor","#00237C"),this.text=c(e,"text","Notification"),this.color=c(e,"color","#fff"),this.fontSize=c(e,"fontSize","16px"),this.fontFamily=c(e,"fontFamily","inherit")}}class _{constructor(e={}){this.img=c(e,"img","https://app-cdn.moengage.com/sdk/cards-error.svg"),this.text=c(e,"text",'Error something went wrong <button onclick="window.location.reload();" style="color: #06A6B7; display: contents;" class="btn-icon pointer-cursor" >Refresh</button>')}}class T{constructor(e){this.headerFontSize=c(e,"headerFontSize","16px"),this.descriptionFontSize=c(e,"descriptionFontSize","14px"),this.ctaFontSize=c(e,"ctaFontSize","12px"),this.fontFamily=c(e,"fontFamily","inherit"),this.horizontalRowColor=c(e,"horizontalRowColor","#D9DFED")}}class S{constructor(e){this.mWebIcon=c(e,"mWebIcon","https://app-cdn.moengage.com/sdk/back-icon.svg"),this.webIcon=c(e,"webIcon","https://app-cdn.moengage.com/sdk/cross-icon.svg"),this.callBack=c(e,"callBack",(()=>{}))}}class y{constructor(e){this.inactiveTabFontColor=c(e,"inactiveTabFontColor","#7C7C7C"),this.fontSize=c(e,"fontSize","14px"),this.fontFamily=c(e,"fontFamily","inherit"),this.backgroundColor=c(e,"backgroundColor","#F6FBFC"),this.active=new O(c(e,"active",{}))}}class I{constructor(e){this.color=c(e,"color","red"),this.enable=c(e,"enable",!1)}}class A{constructor(e){this.family=c(e,"family",""),this.url=c(e,"url","")}}class O{constructor(e){this.color=c(e,"color","#06A6B7"),this.underlineColor=c(e,"underlineColor","#06A6B7"),this.backgroundColor=c(e,"backgroundColor","transparent")}}class w{constructor(e){this.enable=c(e,"enable",!1),this.icon=c(e,"icon","https://app-cdn.moengage.com/sdk/bell-icon.svg"),this.postion=c(e,"postion","0px 10px 40px 0"),this.countBackgroundColor=c(e,"countBackgroundColor","#FF5A5F"),this.countColor=c(e,"countColor","#fff"),this.zIndex=c(e,"zIndex","999998"),this.iconBackgroundColor=c(e,"iconBackgroundColor","#D9DFED"),this.fontFamily=c(e,"fontFamily","inherit")}}class D{constructor(e){this.img=c(e,"img","https://app-cdn.moengage.com/sdk/cards-no-result.svg"),this.text=c(e,"text","No notifications to show, check again later.")}}class L{constructor(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=L.baseLogTag+".constructor";null!=c(e,"app_id",null)?(this.appId=c(e,"app_id",null),this.integrationType=g.OLD_SDK):null!=c(e,"appId",null)?(this.appId=c(e,"appId",null),this.integrationType=g.NEW_SDK):(B.error(1,t,"App Id not specified. Please check docs page to complete the integration - ","https://docs.moengage.com/docs/web-sdk-integration"),this.integrationType=null),null!=c(e,"debug_logs",null)?this.debugLevel=c(e,"debug_logs",0):null!=c(e,"debugLevel",null)?this.debugLevel=c(e,"debugLevel",0):(B.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=c(e,"forceSwUpdate",!1),this.cluster="DC_3",this.cluster=c(e,"cluster",this.cluster),this.cluster&&null!=v[this.cluster.toUpperCase()]&&(this.environment=v[this.cluster.toUpperCase()]),c(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=c(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:c(e,"customSoftAsk.mainClass",null),allowClass:c(e,"customSoftAsk.allowClass",null),dismissClass:c(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:c(e,"main_class",null),allowClass:c(e,"allow_class",null),dismissClass:c(e,"block_class",null)},null!=c(e,"inapp.host",null)&&(this.inapp={host:c(e,"inapp.host",null)}),null!=c(e,"swScope",null)&&(this.swScope=c(e,"swScope",null)),null!=c(e,"disable_onsite",null)&&(this.disableOnsite=c(e,"disable_onsite",!1)),null!=c(e,"enableSPA",null)&&(this.enableSPA=c(e,"enableSPA",!1)),null!=c(e,"cards",null)&&(this.cards=new m(c(e,"cards",{}))),null!=c(e,"api_proxy_domain",null)&&(this.apiProxyDomain=c(e,"api_proxy_domain",null),this.baseDomainName="https://"+this.apiProxyDomain+"/",this.environment=this.apiProxyDomain),null!=c(e,"disable_web_push",null)&&(this.disableWebPush=c(e,"disable_web_push",!1)),null!=c(e,"disableCookies",null)&&(this.disableCookies=c(e,"disableCookies",!1)))}static save(e){l.set(u,new L(e)),x.set(h.INIT_DATA,new L(e))}static get(){return l.get(u)}static setSoftAskConfig(e){var t=L.get();e={appId:t.appId,debugLevel:t.debugLevel,cluster:t.cluster,environment:t.environment,swPath:t.swPath,enableSPA:t.enableSPA,cards:t.cards,apiProxyDomain:t.apiProxyDomain,disableCookies:t.disableCookies,customSoftAsk:{mainClass:c(e,"main_class",c(e,"mainClass",null)),allowClass:c(e,"allow_class",c(e,"allowClass",null)),dismissClass:c(e,"block_class",c(e,"dismissClass",null))}},L.save(e)}}L.baseLogTag="InitData",(z=g=g||{}).OLD_SDK="OLD_SDK",z.NEW_SDK="NEW_SDK";class N{static set(e,t){var n;null!==(n=L.get())&&void 0!==n&&n.disableCookies||(n=N.baseTag+".set",null==t?N.remove(e):(t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),B.log(3,n,"Setting ",e,":",t),n=Date.now(),n=";expires="+new Date(n+31536e6*f).toUTCString(),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+N.getOrigin()+";path=/;SameSite=None; Secure"))}static get(e){var t;if(null===(t=L.get())||void 0===t||!t.disableCookies){var n=N.baseTag+".get",r=e+"=",i=N.getDecodedCookies();for(let o=i.length-1;0<=o;o--){let a=i[o];for(;" "===a.charAt(0);)a=a.substring(1);if(0===a.indexOf(r)){let i=a.substring(r.length,a.length);try{i=JSON.parse(i),"string"===c(i,"MOE_DATA_TYPE",null)?(i=c(i,"actualValue",null),i=i?String(i):null):"boolean"===c(i,"MOE_DATA_TYPE",null)&&(i=c(i,"actualValue",null))}catch(t){}return B.log(3,n,"Got ",e,":",i),i}}return null}}static remove(e){var t;null!==(t=L.get())&&void 0!==t&&t.disableCookies||(t=N.baseTag+".remove",document.cookie=e+"=;domain="+N.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",B.log(3,t,"Removed ",e))}static setRaw(e,t,n){if(null===(r=L.get())||void 0===r||!r.disableCookies){var r=N.baseTag+".setRaw";if(null==t)N.remove(e);else{B.log(3,r,"Setting ",e,":",t);let i="";null!=n&&(i=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+i+";domain="+N.getOrigin()+";path=/;"}}}static getOrigin(){if(null===(e=L.get())||void 0===e||!e.disableCookies){var e=N.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(B.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}static getDecodedCookies(){const e=N.baseTag+".getDecodedCookies";return document.cookie.split(";").map((t=>{let n=t.trim();"%"===n.slice(-1)&&(n+="25");try{return decodeURIComponent(n)}catch(t){return B.error(2,e,"Error decoding cookie:",n,t),n}}))}}N.baseTag="CookieStorage";const R="MOE_DATA";class x{static setPrefix(e){x.prefix=e+"_"}static set(e,t){if(x.baseLogTag,e=x.prefix+e,localStorage){const n=x.getMoeData();n[e]=t,localStorage.setItem(R,JSON.stringify(n))}var n=x.KEYS_SHARED_WITH_COOKIE.indexOf(e);if(x.isSharedWithCookie&&0<=n){const r="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);0===n&&Array.isArray(r.attributes)&&(r.attributes=r.attributes.filter((e=>!!p.includes(e.key)))),e===h.SUBSCRIPTION_DETAILS&&(r.domain=t.domain,r.token=t.token,r.endpoint=t.endpoint,r.keys=t.keys),N.set(e,r)}}static get(e){return x.baseLogTag,e=x.prefix+e,localStorage?c(x.getMoeData(),e,null):null}static remove(e){var t=x.baseLogTag+".remove",n=x.prefix+e;if(localStorage&&null!=x.get(e)){const r=x.getMoeData();delete r[n],localStorage.setItem(R,JSON.stringify(r)),B.log(2,t,"Key",e,"removed.")}x.isSharedWithCookie&&0<=x.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&N.remove(e)}static logout(){const e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA","DEVICE_DATA","SDK_VERSION"];for(const t in h)e.indexOf(t)<0&&x.remove(h[t]);for(const e in h.Q)E.purge(e)}static getString(e){if(e=x.prefix+e,localStorage)return"string"==typeof(e=x.get(e))||e instanceof String?e:JSON.stringify(e)}static removePrefix(){x.prefix=""}static copyKeysFromCookie(){for(let n=0;n<x.KEYS_SHARED_WITH_COOKIE.length;n++){var e=x.KEYS_SHARED_WITH_COOKIE[n],t=N.get(e);if(null!=t){const n="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);if(e===h.USER_DATA&&(t=x.get(e)&&x.get(e).attributes,Array.isArray(n.attributes)&&Array.isArray(t)&&0<t.length)){let e=[...t];n.attributes.forEach((t=>{var n=e.findIndex((e=>e.key===t.key));0<=n?e[n]=t:e.push(t)})),e=e.filter((e=>!(p.includes(e.key)&&n.attributes.findIndex((t=>t.key===e.key))<0))),n.attributes=e}x.set(e,n)}}x.removeStaleKeysFromLS()}static removeStaleKeysFromLS(){var e=x.baseLogTag+".removeStaleKeysFromLS";try{Object.keys(x.getMoeData()).forEach((e=>{this.KEYS_SHARED_WITH_COOKIE.includes(e)&&!N.get(e)&&x.remove(e)}))}catch(t){B.error(1,e,t)}}static getMoeData(){var e=x.baseLogTag+".getMoeData",t=localStorage.getItem(R);if(null==t)return{};try{return JSON.parse(t)}catch(t){return B.error(1,e,t),{}}}}x.baseLogTag="PersistentStorage",x.prefix="",x.isSharedWithCookie=!1,x.KEYS_SHARED_WITH_COOKIE=[h.USER_DATA,h.SUBSCRIPTION_DETAILS,h.SOFT_ASK_STATUS,h.PUSH_TOKEN,h.OPT_IN_SHOWN_TIME,h.HARD_ASK_STATUS,h.SESSION,h.DEVICE_DATA,h.IDENTITY_MAP];class C{static getListeners(){return this.listeners}static getTopicListeners(e){return c(C.topicListeners,e,[])}static addListener(e){C.listeners.push(e)}static addTopicListener(e,t){C.topicListeners[e]=C.getTopicListeners(e),C.topicListeners[e].push(t)}static broadcast(e){C.listeners.map((t=>{t(e)})),c(C.topicListeners,e.topic,[]).map((t=>{t(e)}))}static broadcastToWindow(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data||null}}))}static deprecatedSdkCallback(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))}static resetAllListeners(){C.listeners=[],C.topicListeners={}}static resetListeners(){C.listeners=[]}}C.listeners=[],C.topicListeners={};var k=n(483);class P{static logData(e,t){return{log_type:e,sent_time:(new Date).toISOString(),lake_fields:t}}static setRemoteLogging(e){return this.isTrackingEnabled||(this.logLevel=null==e?void 0:e.configs.logLevel,this.isTrackingEnabled=e.configs.remoteLogTracking,this.isTrackingEnabled)}static log(e,t,n,r,...i){!this.isTrackingEnabled||e!==this.logLevel&&"verbose"!==this.logLevel||window[window.moengage_object||"Moengage"].remoteLogs.addRemoteLogs(this.logData(e,{msg:n+[...i].toString(),file_name:t,trace:r}))}}let M="color: white; background: #41AE55; border-radius: 5px;";class B{static setLogLevel(e,t){var n=B.baseLogTag+".setLogLevel";null==l.get(d)&&l.set(d,[]),null==e?B.logLevel=0:e in[0,1,2]?0<(B.logLevel=e)&&t&&B.releaseAllLogs():B.warn(0,n,"Value",e,"not supported for setDebugLevel(). Current log level is",B.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){B.tagLogStyle=B.tagLogStyle.replace("#48beab",e)}static log(e,t,n,...r){e<=B.logLevel?console.log("%c "+B.logBrand+" %c %c info %c %c "+t+" ",M,"","color: white; background: #18a0bf; border-radius: 5px;","",B.tagLogStyle,n,...r):B.cacheLog((()=>{B.log(e,t,n,...r)}))}static remoteLogTracking(e,t,n,r,...i){P.log(t,n,r,...i),this.log(e,n,r,...i)}static error(e,t,n,...r){var i;null!==(i=r[r.length-1])&&void 0!==i&&i.isCached||P.log("error",t,n,...r),e<=B.logLevel?console.error("%c "+B.logBrand+" %c %c error %c %c "+t+" ",M,"","color: white; background: #cc0a0a; border-radius: 5px;","",B.tagLogStyle,n,...r.slice(0,-1)):B.cacheLog((()=>{B.error(e,t,n,...r,{isCached:!0})}))}static warn(e,t,n,...r){var i;null!==(i=r[r.length-1])&&void 0!==i&&i.isCached||P.log("warning",t,n,...r),e<=B.logLevel?console.warn("%c "+B.logBrand+" %c %c warn %c %c "+t+" ",M,"","color: white; background: #e8ab51; border-radius: 5px;","",B.tagLogStyle,n,...r.slice(0,-1)):B.cacheLog((()=>{B.warn(e,t,n,...r,{isCached:!0})}))}static customLabel(e,t,n,...r){e<=B.logLevel?console.log("%c "+B.logBrand+" %c %c "+t+" %c %c "+n+" %c ",M,"",B.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...r):B.cacheLog((()=>{B.customLabel(e,t,n,...r)}))}static image(e,t){e<=B.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):B.cacheLog((()=>{B.image(e,t)}))}static releaseAllLogs(){var e=l.get(d),t=e.length;const n=e;if(l.set(d,[]),0<t){B.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<t;e++)n[e]();B.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){B.logBrand=e}static setBrandColor(e){M="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let t=l.get(d);null==t&&(t=[]),t.push(e),l.set(d,t)}}B.baseLogTag="Logger",B.logBrand="MoEngage",B.logLevel=0,B.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";class U{static get(e,t){return U.makeNetworkCall(U.METHODS.GET,e,t)}static post(e,t){return U.makeNetworkCall(U.METHODS.POST,e,t)}static makeNetworkCall(e,t,n={}){return new Promise(((r,i)=>{var o=JSON.stringify(c(n,"postData",null));t=((e,t)=>{if(!t)return e;"?"!==e[e.length-1]&&(e+="?");for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return"&"===e[e.length-1]?e.slice(0,-1):e})(t,c(n,"queryParams",null));const a=new XMLHttpRequest;a.open(e,t,!0),U.addRequestHeaders(a,c(n,"headers",{})),a.onreadystatechange=()=>{4===a.readyState&&200===a.status||4===a.readyState&&410===a.status?r({status:a.status,responseText:a.responseText}):4===a.readyState&&200!==a.status&&i({code:a.status,reason:a.responseText})},a.send(o)}))}static addRequestHeaders(e,t){for(const n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e}}(z=(z=U=U||{}).METHODS||(z.METHODS={})).GET="GET",z.POST="POST";const F=U;var W,j,H,G,z,V=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class q{static initialize(){return V(this,void 0,void 0,(function*(){var e;return null==q.ready&&(q.experiencesStore=k.createInstance({driver:[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],name:o.STORES.DATABASE_NAME,storeName:o.STORES.EXPERIENCES.STORE_NAME}),q.aiExperiencesStore=k.createInstance({driver:[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],name:o.STORES.DATABASE_NAME,storeName:o.STORES.AI_EXPERIENCES.STORE_NAME}),q.metaStore=k.createInstance({driver:[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],name:o.STORES.DATABASE_NAME,storeName:o.STORES.META.STORE_NAME}),q.inSessionStore=k.createInstance({driver:[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],name:o.STORES.DATABASE_NAME,storeName:o.STORES.IN_SESSION.STORE_NAME}),q.splitExperiences=k.createInstance({driver:[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],name:o.STORES.DATABASE_NAME,storeName:o.STORES.SPLIT_EXPERIENCES.STORE_NAME}),q.tabbedExperiences=k.createInstance({driver:[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],name:o.STORES.DATABASE_NAME,storeName:o.STORES.TABBED_EXPERIENCES.STORE_NAME}),e=[q.experiencesStore.ready(),q.aiExperiencesStore.ready(),q.metaStore.ready(),q.inSessionStore.ready(),q.splitExperiences.ready(),q.tabbedExperiences.ready()],q.ready=Promise.all(e)),q.ready}))}static clear(){return V(this,void 0,void 0,(function*(){var e=q.baseLogTag+".clear";try{yield q.initialize(),yield Promise.all([q.experiencesStore.clear(),q.aiExperiencesStore.clear(),q.metaStore.clear(),q.splitExperiences.clear(),q.tabbedExperiences.clear()]);var t=[q.experiencesStore.ready(),q.aiExperiencesStore.ready(),q.metaStore.ready(),q.splitExperiences.ready(),q.tabbedExperiences.ready()];q.ready=Promise.all(t)}catch(t){B.error(1,e,"Error clearing web personalization stores:",t)}return q.ready}))}}q.baseLogTag="MOE_WEBP_STORES";class K{constructor(e,t){this.key=e,this.value=t,this.updated_at=(new Date).getTime()}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}class Y{constructor(e,t,n=!0){this.name=e,this.attributes=t,n&&this.attributes.push(new K("URL",location.href))}}class X{constructor(e){var t;this.experiences=null===(t=null==e?void 0:e.experiences)||void 0===t?void 0:t.map((e=>new Q(e))),this.user_in_gcg=e&&e.user_in_gcg,this.personalization_used=null==e?void 0:e.personalization_used,this.split_experiences=(null==e?void 0:e.split_experiences)||[]}}X.baseLogTag="CampaignDataModel";class Q{constructor(e){this.delivery=c(e,"delivery",{}),this.url=c(e,"url",""),this.id=c(e,"id",""),this.gcg_enabled=c(e,"gcg_enabled"),this.expiry_time=c(e,"expiry_time"),this.updated_time=c(e,"updated_time"),this.context=c(e,"context",{}),this.payload=c(e,"payload",[]),this.name=c(e,"name",""),this.status=c(e,"status",""),this.in_session_behaviour_segment=c(e,"in_session_behaviour_segment"),this.url_filters=c(e,"url_filters"),this.is_ai=c(e,"is_ai"),this.page_attributes=c(e,"page_attributes"),this.tab_list=c(e,"tab_list")}}(z=W=W||{}).AND="and",z.OR="or",(z=j=j||{}).BOOL="bool",z.STRING="string",z.DATE="datetime",z.NUMBER="double",z.LONG="long",z.ARRAY_BOOL="array_bool",z.ARRAY_NUMBER="array_double",z.ARRAY_STRING="array_string",z.ARRAY_DATETIME="array_datetime",(z=H=H||{}).EQ="is",z.LT="lessThan",z.GT="greaterThan",z.BETWEEN="between",z.IN="in",z.EXISTS="exists",z.CONTAINS="contains",z.STARTSWITH="startsWith",z.ENDSWITH="endsWith",z.INTHELAST="inTheLast",z.INTHENEXT="inTheNext",z.AFTER="after",z.BEFORE="before",z.ON="on",z.TODAY="today",(z=G=G||{}).ALLOF="all_of",z.ANYOFF="any_of";class J{}J.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi;class ${constructor(e,t,n,r){this.dataType=e,this.availableOperations=t,this.event=n,this.filter=r}validate(){return!(this.availableOperations.indexOf(this.filter.operator)<0)}checkEq(){let e=!1;const t=(t,n)=>{this.dataType===j.STRING&&typeof t===j.STRING&&(t=this.removeSpecialChars(t),n=this.removeSpecialChars(n)),(this.dataType!==j.STRING||this.filter.case_sensitive||t.toLowerCase()!==n.toLowerCase())&&t!==n||(e=!0)};var n;return this.event?this.event.attributes.forEach((e=>{e.key===this.filter.name&&t(e.value,this.filter.value)})):(n=this.getPageContextObjectValue(this.filter.name),t(n,this.filter.value)),e}checkExists(){let e=!1;return this.event?this.event.attributes.forEach((t=>{t.key===this.filter.name&&(e=!0)})):this.getPageContextObjectValue(this.filter.name)&&(e=!0),e}removeSpecialChars(e){return e.replace(J.REMOVE_TRAIL_CHARS,"")}getPageContextObjectValue(e){e=e.split(".");let t=Ge();for(const n of e)t=t[n];return t}}const Z=e=>"string"==typeof e,ee=e=>"[object Date]"===Object.prototype.toString.call(e),te=[H.EQ,H.EXISTS,H.CONTAINS,H.STARTSWITH,H.ENDSWITH,H.IN];class ne extends ${constructor(e,t){super(j.STRING,te,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){var e;ne.baseLogTag;let t=!1;if(this.event&&(e=this.event.attributes.filter((e=>e.key===this.filter.name)),this.value=0<e.length?e[0].value:null),null!=this.value&&Z(this.value))switch(this.filter.operator){case H.EQ:t=this.checkEq();break;case H.EXISTS:t=this.checkExists();break;case H.CONTAINS:t=this.checkContains();break;case H.STARTSWITH:t=this.checkStartsWith();break;case H.ENDSWITH:t=this.checkEndsWith();break;case H.IN:t=this.checkIn()}return this.filter.negate?!t:t}checkContains(){if(this.event){if(this.filter.case_sensitive)return 0<=this.value.indexOf(this.filter.value)}else if(this.filter.case_sensitive)return 0<=this.value.indexOf(this.filter.value);return 0<=this.value.toLowerCase().indexOf(this.filter.value.toLowerCase())}checkStartsWith(){var e=(e,t)=>e.substr(0,t.length)===t;return this.filter.case_sensitive?e(this.value,this.filter.value):e(this.value.toLowerCase(),this.filter.value.toLowerCase())}checkEndsWith(){var e=(e,t,n)=>((void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t);if(this.filter.case_sensitive)return e(this.value,this.filter.value);const t=this.removeSpecialChars(this.value),n=this.removeSpecialChars(this.filter.value);return e(t.toLowerCase(),n.toLowerCase())}checkIn(){let e=!1;if(Array.isArray(this.filter.value))for(let t=this.filter.value.length-1;0<=t;t--)if(this.filter.case_sensitive){if(this.filter.value[t]===this.value){e=!0;break}}else if(this.filter.value[t].toLowerCase()===this.value.toLowerCase()){e=!0;break}return e}}ne.baseLogTag="StringDataType";const re=[H.EQ,H.EXISTS];class ie extends ${constructor(e,t){super(j.BOOL,re,e,t)}evaluate(){let e=!1;switch(this.filter.operator){case H.EQ:e=this.checkEq();break;case H.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e}}ie.baseLogTag="BooleanDataType";const oe=[H.EXISTS,H.ON,H.BETWEEN,H.BEFORE,H.AFTER,H.INTHELAST,H.INTHENEXT,H.TODAY];class ae extends ${constructor(e,t){!ee(t.value)&&Z(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!ee(t.value2)&&Z(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!ee(t.value1)&&Z(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),super(j.DATE,oe,e,t)}evaluate(){ae.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name));const n=0<t.length?t[0]:null;if(null!=n)switch(n.value.setHours(0,0,0,0),this.filter.operator){case H.EQ:e=this.checkEq();break;case H.EXISTS:e=this.checkExists();break;case H.ON:e=this.checkOn(n);break;case H.BETWEEN:e=this.checkBetween(n);break;case H.BEFORE:e=this.checkBefore(n);break;case H.AFTER:e=this.checkAfter(n);break;case H.INTHELAST:e=this.checkLastX(n);break;case H.INTHENEXT:e=this.checkNextX(n);break;case H.TODAY:e=this.checkToday(n)}return this.filter.negate?!e:e}checkOn(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)}checkBetween(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()}checkBefore(t){const{value:n}=this.filter;return typeof n===e?((new Date).setHours(0,0,0,0)-t.value.setHours(0,0,0,0))/864e5>n:t.value.setHours(0,0,0,0)<n.setHours(0,0,0,0)}checkAfter(t){const{value:n}=this.filter;return typeof n===e?(t.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>n:t.value.setHours(0,0,0,0)>n.setHours(0,0,0,0)}checkLastX(e){var t=(new Date).setHours(0,0,0,0);return 0<t-(e=e.value.setHours(0,0,0,0))&&(t-e)/864e5<=this.filter.value}checkNextX(e){var t=(new Date).setHours(0,0,0,0);return 0<(e=e.value.setHours(0,0,0,0))-t&&(e-t)/864e5<=this.filter.value}checkToday(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)}}ae.baseLogTag="DateTimeDataType";const se=[H.EQ,H.EXISTS,H.GT,H.LT,H.BETWEEN,H.IN];class ce extends ${constructor(e,t){super(j.NUMBER,se,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){var e;ce.baseLogTag;let t=!1;if(this.event&&(e=this.event.attributes.filter((e=>e.key===this.filter.name)),this.value=0<e.length?e[0].value:null),null!=this.value&&"number"==typeof this.value)switch(this.filter.operator){case H.EQ:t=this.checkEq();break;case H.EXISTS:t=this.checkExists();break;case H.GT:t=this.checkGreaterThan();break;case H.LT:t=this.checkLessThan();break;case H.BETWEEN:t=this.checkBetween();break;case H.IN:t=this.checkIn()}return this.filter.negate?!t:t}checkGreaterThan(){return this.value>this.filter.value}checkLessThan(){return this.value<this.filter.value}checkBetween(){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=this.value&&this.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=this.value&&this.value<this.filter.value1}checkIn(){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(this.value)}}ce.baseLogTag="NumberDataType";const le=[H.EQ,H.EXISTS,H.CONTAINS,H.STARTSWITH,H.ENDSWITH,H.IN,H.LT,H.GT,H.BETWEEN,H.INTHELAST,H.INTHENEXT,H.AFTER,H.BEFORE,H.ON,H.TODAY];class ue extends ${constructor(e,t){super(t.data_type,le,e,t)}evaluate(){let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name));return null!=(t=0<t.length?t[0]:null)&&(e=>Array.isArray(e))(t.value)&&(e=this.filter.array_filter_type&&this.filter.array_filter_type===G.ANYOFF?this.checkAnyOf(t):this.checkAllOf(t)),e}checkAllOf(e){return e.value.every((t=>this.getFilterResult(t,e)))}checkAnyOf(e){return e.value.some((t=>this.getFilterResult(t,e)))}getFilterResult(e,t){let n=!1;e=this.createCustomEvent(t.key,e);const r=this.getDataType(e);return r.validate()&&(n=r.evaluate()),n}createCustomEvent(e,t){return t=new K(e,t),new Y(this.event.name,[t])}getDataType(e){let t;switch(this.filter.data_type){case j.ARRAY_BOOL:t=new ie(e,this.filter);break;case j.ARRAY_DATETIME:t=new ae(e,this.filter);break;case j.ARRAY_NUMBER:t=new ce(e,this.filter);break;case j.ARRAY_STRING:t=new ne(e,this.filter)}return t}}class de{static doesEventMatchFilters(e,t){de.baseLogTag;let n=!1,r=null;switch(t.data_type){case j.BOOL:r=new ie(e,t),r.validate()&&(n=r.evaluate());break;case j.STRING:r=new ne(e,t),r.validate()&&(n=r.evaluate());break;case j.NUMBER:case j.LONG:r=new ce(e,t),r.validate()&&(n=r.evaluate());break;case j.DATE:r=new ae(e,t),r.validate()&&(n=r.evaluate());break;case j.ARRAY_STRING:case j.ARRAY_DATETIME:case j.ARRAY_BOOL:case j.ARRAY_NUMBER:r=new ue(e,t),r.validate()&&(n=r.evaluate())}return n}static doesValueMatchFilter(e,t){return e=new K(t.name,e),e=new Y("sample event",[e]),de.doesEventMatchFilters(e,t)}}de.baseLogTag="TriggerEvaluator";var he=n(877),fe=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const pe=e=>fe(void 0,void 0,void 0,(function*(){var t;ve(t=e).length&&(t=(e=>{let t=[];return e.forEach((e=>{var n;(null===(n=null==e?void 0:e.in_session_behaviour_segment)||void 0===n?void 0:n.included_filters)&&(t=t.concat(e.in_session_behaviour_segment.included_filters.filters[0].action_name))})),t})(e),q.inSessionStore.setItem(o.STORES.IN_SESSION.IN_SESSION_EVENTS,t))})),ve=e=>e.filter((e=>!!e.in_session_behaviour_segment)),ge=()=>fe(void 0,void 0,void 0,(function*(){return q&&q.inSessionStore?new Promise(((e,t)=>fe(void 0,void 0,void 0,(function*(){var t=yield q.inSessionStore.getItem(o.STORES.IN_SESSION.IN_SESSION_EVENTS_HISTORY);e(t||[])})))):[]}));var Ee=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function me(e){return Ee(this,void 0,void 0,(function*(){var t=c(e,"in_session_behaviour_segment.included_filters.filters",[]),n=c(e,"in_session_behaviour_segment.included_filters.filter_operator","and");if(!(yield function(e,t){return Ee(this,void 0,void 0,(function*(){return new Promise(((n,r)=>Ee(this,void 0,void 0,(function*(){var{count:r,type:i}=e,o=yield Te(t);let a;switch(i){case"exactly":a=o===r;break;case"atleast":a=r<=o;break;case"atmost":a=o<=r}n(a)}))))}))}(t[0].execution,t[0].action_name)))return!1;let r=yield be(t[0]);if(1<t.length)for(let e=0;e<t.length;e++)if(n===W.AND){if(r=!(!r||!(yield be(t[e]))),!1===r)break}else if(n===W.OR&&(r=!(!r&&!(yield be(t[e]))),!0===r))break;return r}))}function be(e){return Ee(this,void 0,void 0,(function*(){const t=c(e,"attributes.filters",[]);let n=!0;if(t&&0<t.length){const o=yield _e(e.action_name);var r=c(e,"attributes.filter_operator","and"),i=t.map((e=>!!o.find((t=>de.doesEventMatchFilters(t,e)))));n=i[0];for(let e=1;e<i.length;e++)if(r===W.AND){if(n=n&&i[e],!1===n)break}else if(r===W.OR&&(n=n||i[e],!0===n))break}return n}))}const _e=e=>Ee(void 0,void 0,void 0,(function*(){return(yield ge()).filter((t=>e===t.name))})),Te=e=>Ee(void 0,void 0,void 0,(function*(){const t=yield ge();let n=0;return t.forEach((t=>{t.name===e&&n++})),n}));var Se=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function ye(e){return Se(this,void 0,void 0,(function*(){return yield function(e,t){return Se(this,void 0,void 0,(function*(){if(!window.moePageContext)return!1;let n=!0;if(e&&0<e.length){var r=e.map((e=>de.doesEventMatchFilters(void 0,e)));n=r[0];for(let e=1;e<r.length;e++)if(t===W.AND){if(n=n&&r[e],!1===n)break}else if(t===W.OR&&(n=n||r[e],!0===n))break}return n}))}(c(e,"page_attributes.filters",[]),c(e,"page_attributes.filter_operator","and"))}))}var Ie=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function Ae(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function Oe(e){return new Date(Date.parse(e))}function we(e,t=15){return e=(new Date).getTime()-new Date(e).getTime(),t<=Math.round(e/6e4)}const De=()=>window.Moengage,Le=()=>{let e={};return e=""!==window.location.search?Ue(window.location.search):Ue(window.location.hash),e},Ne=()=>{var e=Le();return e[o.EDITOR_QUERY_PARAM]&&"1"===e[o.EDITOR_QUERY_PARAM]&&Re()},Re=()=>window.self===window.top,xe=e=>Ie(void 0,void 0,void 0,(function*(){yield Promise.all(e.map((e=>{q.experiencesStore.setItem(e.id,e)})))})),Ce=()=>Ie(void 0,void 0,void 0,(function*(){const e=[];return yield q.experiencesStore.iterate((t=>{e.push(t)})),e})),ke=e=>Ie(void 0,void 0,void 0,(function*(){return yield q.experiencesStore.getItem(e)})),Pe=e=>Ie(void 0,void 0,void 0,(function*(){return yield q.tabbedExperiences.getItem(e)})),Me=()=>Ie(void 0,void 0,void 0,(function*(){var e;return yield null===(e=q.metaStore)||void 0===e?void 0:e.removeItem(o.STORES.META.LAST_FETCHED_TIME)}));function Be(){var e="Web Personalisation.getMetaInfo",t=document.currentScript;let n,r,i,a,s="",c="";if(t){s=o.CLUSTERS.dc_3,t=new URL(t.src);const l=new URLSearchParams(t.search);if(n=l.get("app_id")||"",r=l.get("env")||"",a=l.get("api_proxy_domain")||"",i="true"===l.get("enable_split_url"),l.get("cluster")){const e=l.get("cluster");e&&o.CLUSTER_ENVIRONMENT_MAP[e.toUpperCase()]&&(s=e.toUpperCase())}return"1"!==l.get("debug_logs")||n.includes("_DEBUG")||(n+="_DEBUG"),r?c="https://"+r+"/":s&&(c="https://"+o.CLUSTER_ENVIRONMENT_MAP[s]+"/"),a&&(c="https://"+a+"/"),r||s||B.error(2,e,"Please check WebP integration: data center not present"),n||B.error(2,e,"Please check WebP integration: app_id not present"),{APP_ID:n,HOST:c,CLUSTER:s,ENABLE_SPLIT_URL:i}}return{}}const Ue=e=>{if(e){var t=e.indexOf("?");if(t<0)return{};const n=(e=e.slice(t+1)).replace("?","").split("&"),r={};return n.forEach((e=>{e=(t=e.split("="))[0];var t=decodeURIComponent(t[1]||"");r[e]?"[object Array]"===Object.prototype.toString.call(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t})),JSON.parse(JSON.stringify(r))}return{}};function Fe(e,t){window.MoeWebP.statsData[e]=t}function We(){var e;try{var t=x.get(o.USER_DATA);let n;return t&&t.deviceUuid?n=t.deviceUuid:(n=null===(e=window.MoeWebP)||void 0===e?void 0:e.deviceUuid,n||(n=(0,he.v4)(),window.MoeWebP=window.MoeWebP||{},window.MoeWebP.deviceUuid=n)),n}catch(e){B.error(2,"Web Personalisationutils.getOrSetDeviceUUID","Error fetching or setting device UUID:",e)}}const je=(e,t)=>{let n;return function(...r){clearTimeout(n),n=setTimeout((()=>{e.apply(this,r),n=void 0}),t)}};function He(e){return"is_ai"in e&&0<e.payload.length}function Ge(){return window.moePageContext}function ze(e){return(e=e.split("?")[0]).replace(/^(https?:\/\/)?(www\.)?/,"https://").replace(/\/$/,"")}function Ve(e){var t=ze(window.location.href);return e&&e.redirection_url&&ze(e.redirection_url)!==t&&(location.replace(e.redirection_url),1)}const qe=(e,t,n=!1)=>Ie(void 0,void 0,void 0,(function*(){const r=yield ke(e);return!!r&&(r.payload=t,n&&(r.is_ai=!0),window.MoeWebP.handleDomManipulator(r),!0)}));const Ke=(e,t)=>{if(null!=e&&e.setAttribute){var n=t=>{e.setAttribute(s.DATA_ATTRIBUTE.LABEL_NAME,t)};const r=e.getAttribute(s.DATA_ATTRIBUTE.LABEL_NAME)||"";r&&!r.includes(s.LABELS[t])?n(r+" & "+s.LABELS[t]):n(s.LABELS[t])}};let Ye;const Xe=()=>{Ye=(()=>{const e=document.createElement("div");function t(t){t.stopPropagation();var n=this.getAttribute(s.DATA_ATTRIBUTE.LABEL_NAME);e.textContent=n,n=t.clientX+15,t=t.clientY-35,e.style.left=n+"px",e.style.top=t+"px",e.classList.add("visible")}function n(){e.classList.remove("visible")}return e.classList.add("tooltip"),window.onload=()=>{document.body.appendChild(e)},{enable:function(e=document){e.querySelectorAll(`[${s.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach((e=>{e.addEventListener("mousemove",t),e.addEventListener("mouseleave",n)}))},disable:function(e=document){e.querySelectorAll(`[${s.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach((e=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseleave",n)}))}}})()};class Qe{static initiate(e,t,n,r){var i=Qe.baseLogTag+".initiate";if(!e||!e.type)return B.error(2,i,"Operation type is missing:",e),{success:!1,reason:"invalid type",operation:e};let o;switch(i=e.type){case"insert":o=Qe.handleInsertOp(e,n);break;case"insert_js":o=Qe.handleInsertJSOp(e,n);break;case"replace":o=Qe.handleReplaceOp(e,n);break;case"update":o=Qe.handleUpdateOp(e,n);break;case"update_outerhtml":o=Qe.handleUpdateHTMLOp(e,n);break;case"delete":o=Qe.handleDeleteOp(e,n);break;case"hide":o=Qe.handleHideOp(e,n);break;case"attribute":o=Qe.handleAttributeOp(e,n);break;case"tracking":o=Qe.handleTrackingOp(e,n,t,r);break;case"rearrange":o=Qe.handleReArrangeOp(e,n);break;default:o={success:!1,reason:"invalid type",operation:e}}return o}static handleInsertOp(e,t){var n,r=Qe.baseLogTag+".handleInsertOp";if(e.content&&e.placement){const i=t.querySelector(null==e?void 0:e.selector);if(i){const t=Ae(Re()||null===(n=e.metaData)||void 0===n||!n.html?e.content:null===(n=e.metaData)||void 0===n?void 0:n.html);return Ke(t,e.content.trim().startsWith("<img")?"insert_image":e.type),e.dataMoeId&&t.setAttribute(o.DATA_MOE_SELECTOR_ID,e.dataMoeId),"after"===e.placement?i.parentNode.insertBefore(t,i.nextSibling):"before"===e.placement&&i.parentNode.insertBefore(t,i),B.log(2,r,"Operation applied successfully: ",e),{success:!0}}return B.error(1,r,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e}}return B.error(1,r,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleInsertJSOp(e,t){var n=Qe.baseLogTag+".handleInsertJSOp";if(e.content)try{var r=function(e){try{return JSON.parse(e)}catch(e){return null}}(null==e?void 0:e.content);const t=document.createElement("script");return t.type="text/javascript",t.textContent=r,(document.body||document.head).appendChild(t),B.log(2,n,"Operation applied successfully: ",e),{success:!0}}catch(t){return{success:!1,reason:"Document is not loaded.: "+t,operation:e}}return B.error(1,n,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleReplaceOp(e,t){var n=Qe.baseLogTag+".handleReplaceOp";if(e.content){const r=t.querySelector(e.selector),i=Ae(e.content);return r&&i?(Ke(i,e.type),e.dataMoeId&&i.setAttribute(o.DATA_MOE_SELECTOR_ID,e.dataMoeId),r.replaceWith(i),B.log(2,n,"Operation applied successfully: ",e),{success:!0}):(B.error(1,n,"invalid "+(r?"content ->":"query selector -> "),e),{success:!1,reason:"invalid "+(r?"content":"query selector"),operation:e})}return B.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find  content.",operation:e}}static handleUpdateOp(e,t){var n=Qe.baseLogTag+".handleUpdateOp";if(e.content){const r=t.querySelector(e.selector);return r?(e.dataMoeId&&r.setAttribute(o.DATA_MOE_SELECTOR_ID,e.dataMoeId),r.innerHTML=e.content,B.log(2,n,"Operation applied successfully: ",e),Ke(r,e.type),{success:!0}):(B.error(1,n,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e})}return B.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e}}static handleUpdateHTMLOp(e,t){var n=Qe.baseLogTag+".handleUpdateHTMLOp";if(e.content){const i=t.querySelector(e.selector);if(i){var r=Ae(e.content);return e.tab_info&&(Ke(r,e.type),function(e,t){const n=t.getElementById(e.tab_id);n&&n.classList.remove("moe-hide-tab")}(e.tab_info,t)),e.dataMoeId&&i.setAttribute(o.DATA_MOE_SELECTOR_ID,e.dataMoeId),i.outerHTML=r.outerHTML,B.log(2,n,"Operation applied successfully: ",e),{success:!0}}return B.error(1,n,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e}}return B.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e}}static handleDeleteOp(e,t){var n=Qe.baseLogTag+".handleDeleteOp";const r=t.querySelector(e.selector);return r?(r.remove(),B.log(2,n,"Operation applied successfully: ",e),{success:!0}):(B.error(1,n,"invalid query selector ->",e),{success:!1,reason:"invalid query selector.",operation:e})}static handleHideOp(e,t){var n=Qe.baseLogTag+".handleHideOp";const r=t.querySelector(e.selector);return r&&r.style?(r.style.display="none",Ke(r,e.type),B.log(2,n,"Operation applied successfully: ",e),{success:!0}):(B.error(1,n,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e})}static handleAttributeOp(e,t){var n=Qe.baseLogTag+".handleAttributeOp";if(e.attributes){const r=t.querySelector(e.selector);return r?(Object.keys(e.attributes).forEach((t=>{var n;"style"===t?(n=(n=r.getAttribute(t)||"")+function(e,t){let n=0<t.length&&";"!==t.slice(-1)?";":"";return Object.keys(e).forEach((t=>{n=n+t+":"+e[t]+";"})),n}(e.attributes[t],n),r.setAttribute(t,n)):r.setAttribute(t,e.attributes[t])})),e.dataMoeId&&r.setAttribute(o.DATA_MOE_SELECTOR_ID,e.dataMoeId),Ke(r,e.type),B.log(2,n,"Operation applied successfully: ",e),{success:!0}):(B.error(1,n,"invalid "+(r?"attributes":"query selector "),e),{success:!1,reason:r?"unable to find attributes.":"invalid query selector",operation:e})}return B.error(1,n,"Unable to find attributes.",e),{success:!1,reason:"unable to find attributes.",operation:e}}static handleTrackingOp(e,t,n,r){var i=Qe.baseLogTag+".handleTrackingOp";return t=t.querySelector(null==e?void 0:e.selector),e.id&&r?t&&e.id?(function(t,r){const i=t._moeListeners||[];for(const t of i)if(t.fn===r&&t.operation===e&&t.context===n)return;var o=t=>{r(t,e,n)};t.addEventListener("click",o),t._moeListeners=i.concat({fn:r,operation:e,context:n,clickHandler:o})}(t,this.eventTracking),Ke(t,e.type),B.log(2,i,"Operation applied successfully: ",e),{success:!0}):(B.error(1,i,"invalid "+(t?"ID ":"query selector "),e),{success:!1,reason:t?"unable to track ID.":"invalid query selector",operation:e}):(e.id&&Ke(t,null==e?void 0:e.type),B.error(1,i,"Unable to find ID or it is not a Live Experience.",e),{success:!1,reason:"unable to find ID or it is not a Live Experience.",operation:e})}static eventTracking(e,t,n){var r=e.target.dataset.widgetId;e=e.target.dataset.tabContainerId;const i=Object.assign({b_id:t.id},n);t.widgetId&&(i.widget_id=t.widgetId),e?i.moe_widget_id=e:r&&(i.moe_widget_id=r),De().track_event(o.EVENTS.CLICK,i)}static handleReArrangeOp(e,t){var n=Qe.baseLogTag+".handleReArrangeOp";const r=e.selector&&t.querySelector(e.selector);if(e.orderList&&r){const t=e.orderList.map((e=>(r.children[e].setAttribute("data-moe-rearrange-id",e.toString()),r.children[e])));return r.innerHTML="",t.forEach((e=>{r.appendChild(e)})),e.dataMoeId&&r.setAttribute(o.DATA_MOE_SELECTOR_ID,e.dataMoeId),Ke(r,null==e?void 0:e.type),B.log(2,n,"Operation applied successfully.",e),{success:!0}}return B.error(2,n,"unable to find selector / new order list.",e),{success:!1,reason:"unable to find selector / new order list.",operation:e}}}Qe.baseLogTag="DomManipulator";var Je=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class $e{constructor(){var e=Be();this.appId=e.APP_ID,this.host=e.HOST,this.deviceType=function(){const e=navigator.userAgent.toLowerCase();return function(e){return!!/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(e)}(e)?"tablet":function(){const e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}()?"mweb":e.includes("mac")&&1<navigator.maxTouchPoints?"tablet":"web"}()}getLiveExperiences(e=!1){return Je(this,void 0,void 0,(function*(){var t=Ge();const n={};return!e&&t&&(n.page_attributes=t),new Promise(((t,r)=>Je(this,void 0,void 0,(function*(){this.makeAPICall(o.API.LIVE,{all_exp:e},n,!0).then((n=>{var r;t(new X(n)),n.personalization_used.dpm||e&&(r=new Date,Ie(void 0,void 0,void 0,(function*(){var e;return yield null===(e=q.metaStore)||void 0===e?void 0:e.setItem(o.STORES.META.LAST_FETCHED_TIME,r)})))})).catch((e=>{r(e)}))}))))}))}getTestExperiences(){return Je(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Je(this,void 0,void 0,(function*(){e(this.makeAPICall(o.API.TEST))}))))}))}sendStats(e){return Je(this,void 0,void 0,(function*(){return new Promise(((t,n)=>Je(this,void 0,void 0,(function*(){t(this.makeAPICall(o.API.STATS,void 0,e,!1))}))))}))}getWebActions(){return Je(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Je(this,void 0,void 0,(function*(){e(this.makeAPICall(o.API.WEB_ACTION))}))))}))}getLiveRecommendations(e){return Je(this,void 0,void 0,(function*(){return e.platform=this.deviceType,new Promise(((t,n)=>Je(this,void 0,void 0,(function*(){t(this.makeAPICall(o.API.LIVE_RECOMMENDATIONS,e))}))))}))}isSplitUrlExperince(){return Je(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Je(this,void 0,void 0,(function*(){const t=new Date;e(this.makeAPICall(o.API.SPLIT_URL,{},{user_time:Math.floor(t.getTime()/1e3),user_tz_offset:60*t.getTimezoneOffset()}))}))))}))}getTabData(e,t){return Je(this,void 0,void 0,(function*(){return new Promise(((n,r)=>Je(this,void 0,void 0,(function*(){n(this.makeAPICall(o.API.TAB_DATA,{},{experience_id:e,tab_id:t}))}))))}))}makeAPICall(e,t,n,r){const i=$e.baseLogTag+".makeAPICall";return new Promise(((a,s)=>{var l=function(){const e=new Date;return{day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],hours:String(e.getHours()).padStart(2,"0")}}(),u=function(){const e={};try{var t=x.get(o.IDENTITY_MAP),n=We();!function(){const e=x.get(o.USER_DATA);if(e){let t;null!=e&&e.attributes.map((e=>{"USER_ATTRIBUTE_UNIQUE_ID"===e.key&&(t=e.value)})),null==t||t.toString()}}(),t&&(t.userIdentities&&(e.user_identifiers=t.userIdentities),t.previousIdentities&&(e.previous_user_identifiers=t.previousIdentities)),n&&(e.unique_id=n)}catch(e){B.error(2,"Web Personalisationutils.getUserIdentifier","Error fetching user identifier :",e)}return e}();let d;d=""!==window.location.search?Ue(window.location.search):Ue(window.location.hash);var h,f=window.location.href.split("?")[0];const p=Object.assign(Object.assign(Object.assign({},d),{app_id:this.appId,sdk_ver:"2.53.3",platform:(h=this.deviceType,e===o.API.STATS&&"tablet"===h?"web":h),payload_id:d.payload_id,USER_TYPE:1<(c(x.get(o.SESSION),o.NUMBER_OF_SESSIONS)||0)?"Returning":"New",DAY_OF_THE_WEEK:l.day,TIME_OF_THE_DAY:l.hours,current_url:t?f:void 0,unique_id:u.unique_id}),t),v={headers:{},postData:n,queryParams:{}};[o.API.LIVE,o.API.LIVE_RECOMMENDATIONS,o.API.SPLIT_URL,o.API.TAB_DATA].includes(e)?(delete p.unique_id,v.postData=Object.assign(Object.assign(Object.assign({},v.postData),p),{identifiers:u})):v.queryParams=p;try{if(v.postData)v.headers={"MOE-APPKEY":this.appId,"Content-Type":"application/json"},F.post(""+this.host+e,v).then((e=>{e=JSON.parse(e.responseText),a(e)}));else{const t=(new Date).getTime();B.log(1,i,`API requested Start Time: ${e} -> `,t),F.get(""+this.host+e,v).then((n=>{var o=JSON.parse(n.responseText);B.log(1,i,"Get WebP API call success, response: ",o),n=(new Date).getTime(),B.log(1,i,`API response received Time : ${e} -> `,n),r&&(Fe("api_start_time",t),Fe("api_end_time",n)),a(o)}))}}catch(l){B.error(1,i,"Error getting WebP Test Expressions: ",l),n||(u=(new Date).getTime(),r&&Fe("api_request_failed_time",u)),s("Error getting WebP Expressions")}}))}}$e.baseLogTag="WebPApi";class Ze{static listenToDomChanges(e,t,n,r,i){const a=Ze.baseLogTag+".listenToDOMChanges";var s=i?document:document.querySelector(e.selector);const c=document.location.href,l=je(Ze.retryFailedExperiences.bind(this,i),o.FUNCTION_DEBOUNCE_TIME),u=je((function(e){B.log(2,a,"Dom Observer is disconnected, Total number of retry: "+Ze.observerCounter),h.disconnect()}),o.FUNCTION_DEBOUNCE_TIME),d=je(this.reApplyRevertedChanges.bind(this),o.FUNCTION_DEBOUNCE_TIME),h=new MutationObserver((a=>{let s=!0;var h,f=c!==document.location.href;a.forEach((e=>{var t;"childList"===e.type&&(null===(t=e.removedNodes[0])||void 0===t?void 0:t.nodeValue)===(null===(e=e.addedNodes[0])||void 0===e?void 0:e.nodeValue)&&(s=!1)})),s&&(i?(h=st.failedOperations.length,a=Object.keys(st.moeOperationsWithDataID).length,0<h?l():(Ze.observerCounter>o.MAX_RETRY_OPERATION_ATTEMPTES&&a<1&&h<1||f)&&u(),0<a&&d()):f||this.selectorObserver(e,t,r,n))}));s&&h.observe(s,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}static selectorObserver(e,t,n,r){var i=Ze.baseLogTag+".documentObserver",o=null==t?void 0:t.cid.split("_")[0];B.log(1,i,"Re-applying the operation: ",e),Qe.initiate(e,t,r,n).success&&(o&&!st.appliedExperiences.hasOwnProperty(o)&&(st.appliedExperiences[o]=!0),Ze.listenToDomChanges(e,t,r,n))}static retryFailedExperiences(e){var t=Ze.baseLogTag+".retryFailedExperiences";B.log(2,t,"Retring Failed Operations, Total number of retry attempts: "+Ze.observerCounter),e(),Ze.observerCounter++}static reApplyRevertedChanges(){const e=st.moeOperationsWithDataID,t=Ze.baseLogTag+".documentObserver";B.log(2,t,"Retring Failed Operations, Total number of retry attempts: "+Ze.observerCounter),Object.keys(e).forEach((n=>{const r=e[n];document.querySelector(`[${o.DATA_MOE_SELECTOR_ID}="${n}"]`)||r.forEach((e=>{Qe.initiate(e,void 0,document,!0),B.log(2,t,"Re-applying the operation: ",e)}))})),Ze.observerCounter++}}Ze.baseLogTag="Webp.Listener",Ze.observerCounter=1;class et{constructor(e){this.events={},this.listener=null,this.historyManager=window[a],this.onEvent=e=>{var t=et.baseLogTag+".onEvent";try{this.events[e.name]&&this.events[e.name].forEach((t=>{(t=this.getAttributeValue(e.attributes,t))&&this.trigger(t)}))}catch(e){B.error(2,t,"Error occurred during check event trigger experiences: ",e)}},this.events=e}onTrigger(e){this.listener=e}startWatching(){return function(e,t,n,r){return new(n=n||Promise)((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):((r=e.value)instanceof n?r:new n((function(e){e(r)}))).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){var e=et.baseLogTag+".startWatching";this.historyManager?(B.log(2,e,"Initialized event Trigger Watcher for AI experiences"),this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)):et.startWatchingRetries<=5&&setTimeout((()=>{et.startWatchingRetries++,this.historyManager=window[a],this.startWatching()}),2e3*et.startWatchingRetries)}))}trigger(e){null!=this.listener&&this.listener(e)}getAttributeValue(e,t){let n=null;for(const r of e)if(r.key===t){n=r.value;break}return n}}et.baseLogTag="experienceTriggerManager",et.startWatchingRetries=1;var tt=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},nt=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class rt{constructor(){this.setExperienceTriggerManager=()=>nt(this,void 0,void 0,(function*(){var e=rt.LogTag+".setExperienceTriggerManager",t=yield this.getWebActionEvents();const n=new et(t);B.log(2,e,"Initializing Trigger Manager"),n.onTrigger(this.renderAiExperiences.bind(this)),n.startWatching()})),this.getWebActionEvents=()=>nt(this,void 0,void 0,(function*(){var e,t,n=rt.LogTag+".getWebActionEvents";let r;return we(yield tt(void 0,void 0,void 0,(function*(){return yield q.aiExperiencesStore.getItem(o.STORES.AI_EXPERIENCES.WEB_ACTIONS_LAST_FETCHED_TIME)})),o.SYNC_TIME_FOR_WEB_ACTION_EVENTS)?(B.log(2,n,"synchronizing Web Actions Events data for Real Time Recommendations as time limit exceeded"),r=yield this.WebPApis.getWebActions(),t=r,tt(void 0,void 0,void 0,(function*(){yield q.aiExperiencesStore.setItem(o.STORES.AI_EXPERIENCES.WEB_ACTION_EVENTS,t)})),e=new Date,tt(void 0,void 0,void 0,(function*(){return yield q.aiExperiencesStore.setItem(o.STORES.AI_EXPERIENCES.WEB_ACTIONS_LAST_FETCHED_TIME,e)}))):(r=yield tt(void 0,void 0,void 0,(function*(){return yield q.aiExperiencesStore.getItem(o.STORES.AI_EXPERIENCES.WEB_ACTION_EVENTS)})),B.log(2,n,"Using the cached Web Actions Events data for Real Time Recommendations:",r)),r})),this.WebPApis=new $e}renderAiExperiences(e){return nt(this,void 0,void 0,(function*(){const t=rt.LogTag+".renderAiExperiences",n=yield tt(void 0,void 0,void 0,(function*(){return yield q.aiExperiencesStore.getItem(o.STORES.AI_EXPERIENCES.AI_EXPERIENCE_IDS)}));var r={experience_ids:n,product_id:null==e?void 0:e.toString()};return this.WebPApis.getLiveRecommendations(r).then((e=>(B.log(2,t,"AI Live Recommendations experiences payload: "+n),n.forEach((t=>nt(this,void 0,void 0,(function*(){var n;yield qe(t,null===(n=e[t])||void 0===n?void 0:n.data)})))),!0))).catch((e=>{B.error(2,t,"AI Live Recommendations experiences failed:",e)}))}))}}rt.LogTag="AI Experiences";class it{static listenToDomChanges(){if(document.getElementById(o.ANTI_FLICKER_STYLESHEET)){const e=je((function(){10<it.observerCounter?t.disconnect():(it.observerCounter+=1,it.removeOverLay())}),200),t=new MutationObserver((t=>{let n=!0;t.forEach((e=>{var t;"childList"===e.type&&(null===(t=e.removedNodes[0])||void 0===t?void 0:t.nodeValue)===(null===(e=e.addedNodes[0])||void 0===e?void 0:e.nodeValue)&&(n=!1)})),n&&e()}));document&&t.observe(document,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}else B.log(2,it.baseLogTag,"Anti Flicker Script not available")}static removeOverLay(){var e=it.baseLogTag+".removeOverLay";const t=document.querySelectorAll("."+o.ANTI_FLICKER_HIDE);0<t.length&&t.forEach((e=>{e.classList.add(o.ANTI_FLICKER_SHOW),e.classList.remove(o.ANTI_FLICKER_HIDE)})),document.documentElement.className.includes(o.ANTI_FLICKER_CLASSNAME)&&document.documentElement.classList.remove(o.ANTI_FLICKER_CLASSNAME),B.log(2,e,"Removed WebP Anti-Flicker Styles From:",t)}}it.baseLogTag="Webp.AntiFlickerListener",it.observerCounter=1;var ot=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const at=Be();class st{constructor(){this.statsData={},this.retryExperienceCount=0,this.trackingDelayCounter=1;const e=st.baseLogTag+".constructor";var t;new RegExp(["bot","spider","crawler","crawling","Applebot","PetalBot","pingbot","proximic","AdsBot-Google","Googlebot","Cincraw","SnapchatBot","Snapchat-Proxy/1.0","SnapchatAds","Snapchat-Ads/1.0","YandexRenderResourcesBot","bingbot","slurp","MicrosoftPreview","Baiduspider"].join("|"),"i").test(navigator.userAgent)?B.error(1,e,"Bot detected, Can't initialise the MoEngage WebP SDK"):at.APP_ID&&at.HOST?(this.deviceUuid=We(),this.WebPApis=new $e,this.AiExperiences=new rt,t=(new Date).getTime(),this.isLiveExperience=!1,B.log(2,e,"WEBP SDK Loaded :",t),this.isSentryEnabled()&&("1"===Le()[o.CHECK_TEST_WEBP]?(this.WebPApis.getTestExperiences().then((e=>{this.DomManipulator(e.payload)})),it.removeOverLay(),B.log(2,e,"Web P Test Campaign Dom Manipulation.")):Ne()?(this.getEditorVersion().then((t=>{t===o.STAGING_ERROR?(this.injectEditorFile(o.STAGING_EDITOR_FILE),B.log(2,e,"Web P module initialized in staging editor mode. Version not found, loading default staging editor.")):(this.injectEditorFile(o.EDITOR_FILE(t)),B.log(2,e,"Web P module initialized in editor mode."))})),it.removeOverLay()):Re()?(this.boundIdentityUpdateHandler=this.identityUpdateHandler.bind(this),this.statsData.webP_initialization_time=t,this.getLiveExperiences(),this.handleSPA(),this.handleIdentityChange()):((()=>{const e=document.createElement("style");e.id=s.STYLE.STYLE_ID,e.innerHTML=s.STYLE.STYLE_DATA,document.head.appendChild(e)})(),Xe()))):B.error(2,e,"WebP is not properly integrated")}getLiveExperiences(){return ot(this,void 0,void 0,(function*(){const e=st.baseLogTag+".getLiveExperiences";yield q.initialize(),this.syncExperiences().then((t=>ot(this,void 0,void 0,(function*(){var n,r;t&&t.experiences&&t.experiences.length&&(n=yield(e=>Ie(void 0,void 0,void 0,(function*(){var t;const n=ze(window.location.href),r=[];var i=e.map((e=>Ie(void 0,void 0,void 0,(function*(){var t=ze(new URL(e.url).href);if(null!=e&&e.page_attributes){if(yield ye(e))return e}else if(e.url_filters){if(function(e){const t=(e=>c(e,"url_filters.filters",[]))(e);let n=!0;if(t&&0<t.length){const o=new Y("MOE_PAGE_VIEWED",[]);var r=e.url_filters.filter_operator,i=t.map((e=>de.doesEventMatchFilters(o,e)));n=i[0];for(let e=0;e<i.length;e++)if(r===W.AND){if(n=n&&i[e],!1===n)break}else if(r===W.OR&&(n=n||i[e],!0===n))break}return n}(e))return e;r.push(e.id)}else{if(t===n)return e;r.push(e.id)}}))));i=(yield Promise.all(i)).filter((e=>null==e?void 0:e.id)),0<r.length&&(Fe("current_url",n),Fe("url_failed_experiences",r));let o=!1;const a=[];for(const e of i)(null===(t=null==e?void 0:e.in_session_behaviour_segment)||void 0===t||!t.included_filters||(yield me(e)))&&(a.push(e),o=o||He(e));return o&&window.MoeWebP.clearLastFetchedTime(),a})))(t.experiences),st.appliedExperiences={},st.failedOperations=[],n&&0<n.length?(n=(e=>{const t=[];return e=e.filter((e=>!!(e&&Oe(e.expiry_time+"Z")>new Date)||(t.push(e.id),!1))),0<t.length&&Fe("expired_experiences",t),e=e.sort(((e,t)=>t.delivery.priority-e.delivery.priority)),(e=>{const t={},n=[];return{experiences:e=e.filter((e=>{if(e.is_ai&&n.push(e.id),0===e.payload.length)return!(Number(e.context.moe_variation_id)>1);let r=!1;return e.payload.forEach((n=>{const i=n.widgetId&&"insert_js"===n.type?n.selector+"_"+n.type+"_"+n.widgetId:n.selector+"_"+n.type;n.widgetId&&!n.content||t[i]||(r=!0,t[i]=n,t[i].expId=e.id)})),r})),allOp:t,aiExperienceIds:n}})((e=>e.sort(((e,t)=>e.delivery.priority===t.delivery.priority&&(e=e.updated_time,t=t.updated_time,0<Oe(e+"Z").getTime()-Oe(t+"Z").getTime())?-1:1)))(e))})(n),st.allOperations=n.allOp,st.experiences=n.experiences,r=n.aiExperienceIds,tt(void 0,void 0,void 0,(function*(){yield q.aiExperiencesStore.setItem(o.STORES.AI_EXPERIENCES.AI_EXPERIENCE_IDS,r)})),n.aiExperienceIds&&0<n.aiExperienceIds.length&&this.AiExperiences.setExperienceTriggerManager(),st.experiences&&st.experiences.length&&st.experiences[0].id&&Fe("ids",st.experiences.map((e=>e.id))),B.log(2,e,"Eligible Experiences found: ",st.experiences),st.experiences.forEach((e=>{this.handleLiveExperience(e,t.user_in_gcg)}))):this.noExperienceFoundStats())})))).catch((t=>{B.error(1,e,"Error syncing Experiences: ",t)})).finally((()=>{it.listenToDomChanges()}))}))}handleLiveExperience(e,t){var n=st.baseLogTag+".handleLiveExperience";e&&e.gcg_enabled&&t?(Fe("in_gcg",{experience:e.gcg_enabled,user:t}),B.log(2,n,"GCG is Enabled for both User and Experience: ",{experience:e,userIsGCG:t}),new Promise((()=>{this.WebPApis.sendStats(Object.assign(Object.assign({},e.context),{gcg_event:!0})),this.WebPApis.sendStats(this.statsData).then((e=>{null!=e&&e.success&&(this.statsData={})}))}))):e?(B.log(2,n,"Going to trigger this experience: ",e),e.payload.length?e&&this.handleDomManipulator(e):(this.isLiveExperience=!0,st.appliedExperiences[e.id]=!0,this.handleDomManipulationComplete(e,[],!0))):this.noExperienceFoundStats()}noExperienceFoundStats(){return ot(this,void 0,void 0,(function*(){var e=st.baseLogTag+".noExperienceFoundStats";return B.log(2,e,"No eligible experience found"),new Promise((()=>{this.WebPApis.sendStats(this.statsData).then((e=>{null!=e&&e.success&&(this.statsData={})}))}))}))}syncExperiences(){return ot(this,void 0,void 0,(function*(){const e=st.baseLogTag+".syncExperiences";return new Promise(((t,n)=>ot(this,void 0,void 0,(function*(){try{var r,i,a,s=yield Ie(void 0,void 0,void 0,(function*(){var e;return yield null===(e=q.metaStore)||void 0===e?void 0:e.getItem(o.STORES.META.LAST_FETCHED_TIME)}));we(s)||!s?(B.log(2,e,"synchronizing experiences as time limit exceeded"),at.ENABLE_SPLIT_URL&&this.WebPApis.isSplitUrlExperince().then((e=>{Ve(e)})),yield Ie(void 0,void 0,void 0,(function*(){yield q.experiencesStore.clear(),yield q.aiExperiencesStore.clear(),yield q.metaStore.clear(),yield q.splitExperiences.clear(),yield q.tabbedExperiences.clear()})),r=yield this.WebPApis.getLiveExperiences(),pe(r.experiences),r.experiences&&(yield xe(r.experiences)),t(r),yield this.WebPApis.getLiveExperiences(!0).then((e=>ot(this,void 0,void 0,(function*(){var t,n;t=e&&e.user_in_gcg,Ie(void 0,void 0,void 0,(function*(){var e;return yield null===(e=q.metaStore)||void 0===e?void 0:e.setItem(o.STORES.META.USER_IN_GCG,t)})),pe(e.experiences),xe(e.experiences),n=e.split_experiences,Ie(void 0,void 0,void 0,(function*(){yield Promise.all(n.map((e=>Ie(void 0,void 0,void 0,(function*(){var t=ze(e.url);yield q.splitExperiences.setItem(t,e)})))))}))}))))):(at.ENABLE_SPLIT_URL&&(yield function(){return Ie(this,void 0,void 0,(function*(){var e,t=ze(window.location.href);return e=t,!!((t=yield Ie(void 0,void 0,void 0,(function*(){return yield q.splitExperiences.getItem(e)})))&&Oe(t.expiry_time+"Z")>new Date)}))}())&&this.WebPApis.isSplitUrlExperince().then((e=>{Ve(e)})),i=yield Ce(),a=yield Ie(void 0,void 0,void 0,(function*(){var e;return yield null===(e=q.metaStore)||void 0===e?void 0:e.getItem(o.STORES.META.USER_IN_GCG)})),t({experiences:i,user_in_gcg:a}),B.log(2,e,"Using the cached experiences for Web Personalisation"))}catch(r){n(r)}}))))}))}handleDomManipulator(e){var t=st.baseLogTag+".DomManipulator";this.isLiveExperience=!0;var n=e&&e.payload;this.domManipulatorStartTime=(new Date).getTime();var r=e.context;B.log(2,t,null!=r&&r.cid?`Going to render experience with ID: ${r.cid} and `:" ","Operations: ",n),B.log(2,t,"Dom Manipulator start Time: ",this.domManipulatorStartTime);let i=[];!e.is_ai&&st.allOperations?Object.keys(st.allOperations).forEach((t=>{(t=st.allOperations[t]).expId===e.id&&i.push(t)})):i=e.payload,i.length&&this.DomManipulator(i,e.id,document,r),st.failedOperations.length?this.completeDomManipulationTimer=setTimeout((()=>{this.handleDomManipulationComplete(e,this.retryFailedOperations)}),o.RETRY_INTERVAL):this.handleDomManipulationComplete(e,[],!0),this.isDomMutationObserverAdded||(Ze.listenToDomChanges(null,null,null,null,this.retryFailedOperations.bind(this,e)),this.isDomMutationObserverAdded=!0)}DomManipulator(e,t,n=document,r){const i=st.baseLogTag+".DomManipulator";e.forEach((e=>{try{Qe.initiate(e,r,n,this.isLiveExperience).success?(e.dataMoeId?this.saveMoeDataIdOperations(e):["insert","rearrange","insert_js"].includes(e.type)||Ze.listenToDomChanges(e,r,n,this.isLiveExperience),st.appliedExperiences.hasOwnProperty(t)||(st.appliedExperiences[t]=!0),st.isAnyOperationSuccessfull||(st.isAnyOperationSuccessfull=!0)):st.failedOperations=st.failedOperations.concat([[e,r,n,this.isLiveExperience]])}catch(e){B.error(2,i,"Error in Dom Manipulation",e)}}))}retryFailedOperations(e){var t=st.baseLogTag+".startRetry";B.log(2,t,"Retrying failed operations: ",st.failedOperations);var n=st.failedOperations.concat([]);st.failedOperations=[],n=this.handleRetry(n,e.id),this.retryExperienceCount++,0===st.failedOperations.length&&(B.log(2,t,"Total number of times retried applying webP changes: ",this.retryExperienceCount-1),clearTimeout(this.completeDomManipulationTimer),this.handleDomManipulationComplete(e,n)),it.removeOverLay()}handleRetry(e,t){const n=[];for(;0<e.length;){var r=e.pop(),i=Qe.initiate.apply(null,r);i.success?"insert_js"!==r[0].type&&(r[0].dataMoeId?this.saveMoeDataIdOperations(r[0]):["insert","rearrange"].includes(r[0].type)||Ze.listenToDomChanges.apply(Ze,r),st.appliedExperiences.hasOwnProperty(t)||(st.appliedExperiences[t]=!0),st.isAnyOperationSuccessfull||(st.isAnyOperationSuccessfull=!0)):(n.push(i),st.failedOperations=st.failedOperations.concat([r]))}return n}handleDomManipulationComplete(e,t,n){var r=st.baseLogTag+".handleDomManipulationComplete",i=e.context;e=(new Date).getTime(),B.log(2,r,"Dom end Time: ",e),this.domManipulatorStartTime&&B.log(1,r,`Total time taken to manipulate the DOM: ${(e-this.domManipulatorStartTime)/1e3}s`),this.isLiveExperience&&(t&&t.length&&Fe("payload_failer",{reason:"Experiences payload Failed to Execute",campaign_id:null==i?void 0:i.cid,data:t}),this.domManipulatorStartTime&&(Fe("dom_manipulator_start_time",this.domManipulatorStartTime),Fe("dom_manipulator_end_time",e)),new Promise((()=>{this.WebPApis.sendStats(this.statsData).then((e=>{null!=e&&e.success&&(this.statsData={})}))})),(st.isAnyOperationSuccessfull||n)&&(setTimeout((()=>Object.keys(st.appliedExperiences).map((e=>ot(this,void 0,void 0,(function*(){st.appliedExperiences[e]&&(yield this.track(e))}))))),this.trackingDelayCounter),this.trackingDelayCounter++))}getEditorVersion(){return ot(this,void 0,void 0,(function*(){const e=st.baseLogTag+".getEditorVersion";return new Promise(((t,n)=>ot(this,void 0,void 0,(function*(){var r=Ue(window.location.search);if(function(){const e=Be().HOST;return e&&e.includes("moestaging")}())return r.webPStagingVersion&&t(r.webPStagingVersion),void t(o.STAGING_ERROR);var i=yield F.get(""+o.VERSION_FILE);if(200===i.status)try{var a=JSON.parse(i.responseText);"1"===r.pre_prod&&t(a[o.PRE_PROD]),t(a[at.CLUSTER]||"")}catch(r){B.error(2,e,"Error in getting editor version file",r),n(r)}t("")}))))}))}injectEditorFile(e){return ot(this,void 0,void 0,(function*(){return new Promise(((t,n)=>ot(this,void 0,void 0,(function*(){const t=document.createElement("script");t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}))))}))}track(e){return ot(this,void 0,void 0,(function*(){st.appliedExperiences[e]=!1;let t=yield ke(e);t=t||st.experiences.find((t=>t.id===e)),t&&(this.eventTracking(o.EVENTS.IMPRESSION,t.id,t.context),t.tab_list&&this.renderTabbedExperience(e,t.tab_list))}))}isSentryEnabled(){var e=st.baseLogTag+".isSentryEnabled";try{var t=JSON.parse(localStorage.getItem("MOE_DATA"));return!(t&&t.WEB_SETTINGS&&t.WEB_SETTINGS.configs)||t.WEB_SETTINGS.configs.isWebPersonalisationModuleEnabled}catch(t){B.error(1,e,"Error in getting sentry flag for webp: ",t)}}clearLastFetchedTime(e){return ot(this,void 0,void 0,(function*(){return B.log(2,"MoeWebP.clearLastFetchedTime","Clearing cache for Web Personalisation"),e&&(st.failedOperations=[]),yield Me()}))}isEditorModeEnabled(){return Ne()||!Re()}setLogLevel(e){B.setLogLevel(e,!1),B.setLogTabStyle("#85586F")}handleInSessionEvent(e){return ot(this,void 0,void 0,(function*(){var t,n=st.baseLogTag+".handleInSessionEvent";(yield fe(void 0,void 0,void 0,(function*(){return q&&q.inSessionStore&&(yield q.inSessionStore.getItem(o.STORES.IN_SESSION.IN_SESSION_EVENTS))||[]}))).includes(e.name)&&(B.log(2,n,"Event found in Web personalization experience: ",e.name),t=e,fe(void 0,void 0,void 0,(function*(){const e=yield ge();e.unshift(t),e.length>o.MAX_EVENTS_FOR_IN_SESSION&&e.pop(),q.inSessionStore.setItem(o.STORES.IN_SESSION.IN_SESSION_EVENTS_HISTORY,e)})))}))}saveMoeDataIdOperations(e){st.moeOperationsWithDataID[e.dataMoeId]?st.moeOperationsWithDataID[e.dataMoeId].push(e):st.moeOperationsWithDataID[e.dataMoeId]=[e]}eventTracking(e,t,n,r){var i=st.baseLogTag+".eventTracking";try{return De()?(B.log(1,i,e+": Event Tracked"),De().track_event(e,Object.assign({campaign_id:t},n))):(window.moengage_q=window.moengage_q||[]).push({f:"track_event",a:[e,Object.assign(Object.assign({campaign_id:t},n),r)]}),Promise.resolve()}catch(e){B.error(2,i,"Failed Tracking expression",e)}}trackClick(e,t,n){return this.eventTracking(o.EVENTS.CLICK,e,t,n)}previewExperiences(e,t){var n=st.baseLogTag+".previewExperiences";return B.log(2,n,(e?"Adding":"Removing")+" border and label to personalized experiences"),(e?(e=document)=>{var t="Web Personalisation.previewExperiences";Ye.enable||B.error(2,t,"Preview mode is not enabled"),e.querySelectorAll(`[${s.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach((e=>{e.classList.add(s.ELEMENT_BORDER_CLASS),e.getAttribute("title")&&e.setAttribute(s.DATA_ATTRIBUTE.BACKUP_TITLE,e.getAttribute("title")),e.setAttribute("title","")})),Ye.enable(e),B.log(2,t,"Border and label's added to personalized experiences")}:(e=document)=>{var t="Web Personalisation.previewExperiences";Ye.disable||B.error(2,t,"Preview mode is not enabled"),e.querySelectorAll(`[${s.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach((e=>{e.classList.remove(s.ELEMENT_BORDER_CLASS),e.removeAttribute("title"),e.getAttribute(s.DATA_ATTRIBUTE.BACKUP_TITLE)&&(e.setAttribute("title",e.getAttribute(s.DATA_ATTRIBUTE.BACKUP_TITLE)),e.removeAttribute(s.DATA_ATTRIBUTE.BACKUP_TITLE))})),Ye.disable(e),B.log(2,t,"Border and label's removed from personalized experiences")})(t)}renderTabbedExperience(e,t){return ot(this,void 0,void 0,(function*(){const n=st.baseLogTag+".renderTabbedExperience";try{var r=yield Pe(e);if(!r){var i=t.map((t=>t.is_ai?Promise.resolve():this.WebPApis.getTabData(e,t.tab_id).then((t=>ot(this,void 0,void 0,(function*(){if(t&&t[e]){var r=t[e]&&t[e].data;return i=e,o=r,Ie(void 0,void 0,void 0,(function*(){let e;return Pe(i).then((t=>Ie(void 0,void 0,void 0,(function*(){t&&(o=o.concat(t)),e=yield q.tabbedExperiences.setItem(i,o)})))),e})),qe(e,r,!0)}return B.error(2,n,"No payload found for tabbed experience",e),!1;var i,o})))).catch((t=>{B.error(2,n,`Failed to get tabbed experience data ${e}:`,t)}))));return Promise.all(i)}yield qe(e,r,!0)}catch(r){throw B.error(2,n,`Error in getTabbedData ${e}:`,r),r}}))}renderPageTypeExperience(e){return ot(this,void 0,void 0,(function*(){var t,n=st.baseLogTag+".renderPageTypeExperience";if(e){t=e,window.moePageContext=t;try{const e=yield function(){return Ie(this,void 0,void 0,(function*(){const e="Web Personalisationutils.getPageTypeExperiences";try{const t=(yield Ce())||[];return t.length?(yield Promise.all(t.map((t=>Ie(this,void 0,void 0,(function*(){try{if(t.page_attributes)return(yield ye(t))?t:null}catch(n){B.error(2,e,"Error evaluating page context for experience:",t,n)}return null})))))).filter(Boolean):[]}catch(t){throw B.error(2,e,"Error getting pageType experiences:",t),t}}))}();let t=!1;return e&&e.forEach((e=>{e&&!st.appliedExperiences.hasOwnProperty(e.id)&&(e.is_ai=!0,this.handleDomManipulator(e),t=!0)})),t}catch(t){return B.error(2,n,"Error getting pageType experiences:",t),!1}}return B.error(2,n,"No pageContext provided"),!1}))}handleSPA(){window.addEventListener("SPA",(e=>{"PAGE_CHANGED"===e.detail.name&&this.getLiveExperiences()}))}handleIdentityChange(){removeEventListener(t,this.boundIdentityUpdateHandler),window.addEventListener(t,this.boundIdentityUpdateHandler)}identityUpdateHandler(e){return ot(this,void 0,void 0,(function*(){e.detail.name===i.USER_IDENTITY_UPDATE&&(Me(),this.syncExperiences())}))}}st.baseLogTag="Web Personalisation",st.failedOperations=[],st.isAnyOperationSuccessfull=!1,st.appliedExperiences={},st.moeOperationsWithDataID={},window.MoeWebP=new st})()})();